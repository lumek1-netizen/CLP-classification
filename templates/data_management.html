{% extends "base.html" %}

{% block title %}Spr치va dat{% endblock %}

{% block content %}
<div class="container mt-5">

    <!-- Sticky Action Bar -->
    <div class="sticky-action-bar">
        <div class="d-flex align-items-center" style="gap: 1.5rem;">
            <h2 style="margin: 0; white-space: nowrap; margin-right: auto;">Spr치va dat</h2>
        </div>
    </div>

    <hr>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="mb-4">
        {% for category, message in messages %}
        <div class="alert alert-{{ category }} mb-2" role="alert">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    {% if current_user.has_role('admin') %}

    <!-- 1. System Backup (JSON) -->
    <div class="mb-5">
        <h3 class="text-lg font-bold text-secondary mb-3">游닍 Z치loha syst칠mu (JSON)</h3>
        <p class="text-muted text-sm mb-4">Kompletn칤 z치loha v코ech dat (l치tky i sm캩si) pro 칰캜ely archivace nebo p콏enosu.
        </p>

        <div class="d-grid gap-4" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">
            <!-- Export JSON -->
            <div class="card h-100">
                <div class="card__header">
                    <h3 class="card__title">游닋 Exportovat data</h3>
                </div>
                <div class="card__body d-flex flex-column">
                    <p class="text-sm text-muted flex-grow-1 mb-4">
                        St치hn캩te aktu치ln칤 stav datab치ze do jednoho souboru <code>.json</code>.
                    </p>
                    <a href="{{ url_for('data.export_data') }}"
                        class="button button-primary w-100 text-center text-decoration-none">
                        拘勇 St치hnout JSON
                    </a>
                </div>
            </div>

            <!-- Import JSON -->
            <div class="card h-100">
                <div class="card__header">
                    <h3 class="card__title">游닌 Importovat data</h3>
                </div>
                <div class="card__body">
                    <p class="text-sm text-muted mb-4">
                        Nahrajte d콏칤ve vytvo콏enou z치lohu. <span class="text-warning">Existuj칤c칤 polo쬶y nebudou
                            p콏eps치ny.</span>
                    </p>
                    <form action="{{ url_for('data.import_data') }}" method="POST" enctype="multipart/form-data">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <div class="form-group mb-3">
                            <input type="file" name="file" accept=".json" required class="form-control">
                        </div>
                        <button type="submit" class="button button-secondary w-100">
                            拘勇 Nahr치t a obnovit
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- 2. Substances CSV -->
    <div class="mb-5">
        <h3 class="text-lg font-bold text-secondary mb-3">游늵 Hromadn치 spr치va l치tek (CSV)</h3>
        <p class="text-muted text-sm mb-4">Import a export tabulkov칳ch dat pro Excel.</p>

        <div class="d-grid gap-4" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">
            <!-- Import CSV -->
            <div class="card h-100">
                <div class="card__header">
                    <h3 class="card__title">游닌 Import z CSV</h3>
                </div>
                <div class="card__body">
                    <p class="text-sm text-muted mb-4">
                        Nahrajte soubor <code>.csv</code> s definicemi l치tek.
                    </p>

                    <div class="bg-secondary rounded p-3 mb-4 border border-color">
                        <p class="text-xs text-primary mb-0"><strong>游눠 Tip:</strong> St치hn캩te si 코ablonu pro spr치vn칳
                            form치t sloupc콢.</p>
                    </div>

                    <form action="{{ url_for('data.import_substances_csv') }}" method="POST"
                        enctype="multipart/form-data">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <div class="form-group mb-3">
                            <input type="file" name="file" accept=".csv" required class="form-control">
                        </div>
                        <div class="d-flex gap-2">
                            <button type="submit" class="button button-primary flex-grow-1">Importovat</button>
                            <a href="{{ url_for('data.download_csv_template') }}"
                                class="button button-secondary text-decoration-none">마blona</a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Export CSV -->
            <div class="card h-100">
                <div class="card__header">
                    <h3 class="card__title">游닋 Export do CSV</h3>
                </div>
                <div class="card__body d-flex flex-column">
                    <p class="text-sm text-muted flex-grow-1 mb-4">
                        Exportuje kompletn칤 seznam l치tek v캜etn캩 ATE a 2026 roz코칤콏en칤 do form치tu CSV.
                    </p>
                    <a href="{{ url_for('data.export_substances_csv') }}"
                        class="button button-primary w-100 text-center text-decoration-none">
                        拘勇 Exportovat CSV
                    </a>
                </div>
            </div>
        </div>
    </div>

    {% else %}
    <div class="alert alert-warning text-center p-5">
        <h4 class="mb-2">游뛂 P콏칤stup odep콏en</h4>
        <p>Tato sekce je p콏칤stupn치 pouze u쬴vatel콢m s rol칤 <strong>Administr치tor</strong>.</p>
    </div>
    {% endif %}

</div>

{% endblock %}